/* 1. Reset & Base Styles */
:root {
  /* Font Families */
  --font-body: 'Noto Sans JP', sans-serif;
  --font-display: 'Poppins', sans-serif;
  --font-accent: 'Shippori Mincho', serif; /* アクセント用フォント */

  /* Colors */
  --color-text: #3D405B;
  --color-bg: #F2CC8F; /* ベースカラーを少し暖色系に */
  --color-primary: #E07A5F;
  --color-primary-dark: #D46A4F;
  --color-secondary: #81B29A;
  --color-accent: #F4F1DE;
  --color-surface: #FFFFFF;
  --color-border: #EAEAEA;
  --gradient-bg: linear-gradient(170deg, #F4F1DE 0%, #E07A5F 200%);

  /* Styles */
  --shadow-sm: 0 4px 8px rgba(0,0,0,0.04);
  --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
  --radius-md: 12px;
  --radius-lg: 24px;
}

*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-body);
  color: var(--color-text);
  -webkit-font-smoothing: antialiased;
  /* グラデーションとテクスチャ背景 */
  background-color: var(--color-bg);
  background-image: var(--gradient-bg), url('https://www.transparenttextures.com/patterns/subtle-zebra-3d.png');
  padding-bottom: 80px; /* Footer height */
}

/* 2. App Loader */
.app-loader {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background-color: #F2CC8F; z-index: 10000; display: flex;
  justify-content: center; align-items: center; opacity: 1;
  transition: opacity 0.5s ease; pointer-events: auto;
}
.app-loader:not(.active) { opacity: 0; pointer-events: none; }
.loading-spinner {
  width: 50px; height: 50px; border: 5px solid var(--color-primary);
  border-top: 5px solid var(--color-accent); border-radius: 50%;
  animation: spin 1s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* 3. Layout & Header */
#app-root {
  max-width: 640px; margin: 0 auto; background-color: transparent;
  min-height: 100vh; overflow-x: hidden; /*
  
   */
}
.app-header {
  background: transparent; color: var(--color-text); padding: 16px;
}
.header-container {
  display: flex; justify-content: space-between; align-items: center;
}
.logo { display: flex; align-items: center; gap: 8px; }
.logo-icon { height: 28px; width: auto; }
.logo-text { font-family: var(--font-display); font-size: 20px; font-weight: 800; }
#user-status .btn {
  background-color: rgba(255,255,255,0.3);
  border: 1px solid rgba(61, 64, 91, 0.2);
  color: var(--color-text); padding: 6px 12px; font-size: 12px;
}

/* 4. Footer Navigation */
.footer-nav {
  position: fixed; bottom: 0; left: 0; right: 0; max-width: 640px;
  margin: 0 auto; height: 65px; background-color: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  border-top: 1px solid rgba(255, 255, 255, 0.5);
  display: flex; justify-content: space-around;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
}
.nav-link {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; height: 100%; flex-grow: 1;
  text-decoration: none; color: #6c757d; font-size: 10px;
  gap: 2px; transition: all 0.2s ease; background: none;
  border: none; cursor: pointer;
}
.nav-link.active { color: var(--color-primary); transform: translateY(-2px); }
.nav-link.active svg { stroke: var(--color-primary); }

/* 5. Sections & Content */
.section {
  position: absolute; top: 0; left: 0; width: 100%;
  padding: 20px 16px; opacity: 0;
  transform: translateX(30px);
  transition: opacity 0.5s ease, transform 0.5s ease;
  pointer-events: none;
}
.section.active {
  position: relative; opacity: 1; transform: translateX(0);
  pointer-events: auto; animation: fadeIn 0.6s cubic-bezier(0.25, 1, 0.5, 1);
}
.section.is-exiting {
  position: absolute; opacity: 0; transform: translateX(-30px);
  pointer-events: none;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.card {
  background: var(--color-surface); border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md); margin-bottom: 24px; overflow: hidden;
  border: 1px solid #fff;
}
.card-header {
  padding: 24px; border-bottom: 1px solid var(--color-border);
  font-family: var(--font-display);
}
.card-header h2 { font-size: 28px; line-height: 1.2; margin-bottom: 4px; }
.card-header p { font-size: 14px; color: #6c757d; margin: 0; }
.card-body { padding: 20px; }
.card-footer { padding: 20px; background-color: #f8f9fa; border-top: 1px solid var(--color-border); }

/* 6. Buttons & Forms */
.btn {
  display: inline-flex; align-items: center; justify-content: center;
  gap: 8px; font-family: var(--font-display); font-weight: 600;
  border-radius: var(--radius-md); padding: 12px 24px; border: none;
  cursor: pointer; transition: all 0.2s ease; text-decoration: none;
}
.btn-primary { background-color: var(--color-primary); color: white; }
.btn-primary:hover { background-color: var(--color-primary-dark); transform: translateY(-2px); }
.btn-secondary { background-color: var(--color-border); color: var(--color-text); }
.btn-secondary:hover { background-color: #d3d3d3; }
.btn:disabled { background-color: #e9ecef; color: #adb5bd; cursor: not-allowed; }
.btn-full { width: 100%; }
input[type="email"], input[type="text"] {
  width: 100%; padding: 12px; border: 1px solid var(--color-border);
  border-radius: var(--radius-md); font-size: 16px; margin-bottom: 16px;
  background-color: var(--color-accent);
}

/* 7. Feed Page (Typography & Layout Refresh) */
.category-tabs {
  display: flex; gap: 8px; margin-bottom: 20px;
  overflow-x: auto; padding-bottom: 8px;
}
.category-tab {
  white-space: nowrap; padding: 8px 16px; border-radius: 99px;
  background: rgba(255,255,255,0.5); border: none; color: var(--color-text);
  cursor: pointer; transition: all 0.2s ease; font-weight: 600;
}
.category-tab.active { background: var(--color-secondary); color: white; }

.articles-container .card {
  width: calc(50% - 10px); /* Masonry用 */
  margin-bottom: 20px;
  position: relative;
  /* スクロールアニメーション用 */
  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.6s ease, transform 0.6s ease;
}
.articles-container .card.is-visible {
  opacity: 1;
  transform: translateY(0);
}

.article-link {
  display: block; text-decoration: none; color: inherit;
  border-radius: var(--radius-lg); overflow: hidden; cursor: pointer;
}
.articles-container .card-body { padding: 16px; }
.articles-container .article-title {
  font-family: var(--font-display);
  font-size: 24px; /* 大胆な見出し */
  font-weight: 800;
  line-height: 1.1;
  margin-top: -30px; /* 画像に重ねる */
  position: relative;
  z-index: 2;
  color: white;
  text-shadow: 0 2px 5px rgba(0,0,0,0.5);
  padding: 0 16px;
  word-break: break-all; /* 単語の途中でも改行 */
}
.articles-container .article-excerpt { display: none; } /* 省略してタイトルを際立たせる */
.articles-container img {
  width: 100%; height: 220px; object-fit: cover;
  border-radius: var(--radius-lg);
  filter: brightness(0.8); /* タイトルが見やすいように少し暗く */
  transition: transform 0.4s ease, filter 0.4s ease;
}
.articles-container .card:hover img {
  transform: scale(1.05);
  filter: brightness(1);
}

/* 8. Stamp Card Page (Animation Refresh) */
.stamp-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
.stamp {
  aspect-ratio: 1 / 1; border-radius: 50%; background-color: var(--color-accent);
  border: 2px dashed var(--color-border); display: flex; align-items: center;
  justify-content: center; transition: all 0.3s ease;
}
.stamp .stamp-number { font-family: var(--font-display); font-size: 24px; color: #ddd; }
.stamp.active {
  border-style: solid; border-color: var(--color-secondary);
  background-color: transparent;
  transform: scale(1);
  /* インクが染み込むアニメーション */
  -webkit-mask-image: radial-gradient(circle, black 0%, black 0%, rgba(0,0,0,0) 0%);
  mask-image: radial-gradient(circle, black 0%, black 0%, rgba(0,0,0,0) 0%);
  animation: ink-spread 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}
@keyframes ink-spread {
  to {
    -webkit-mask-image: radial-gradient(circle, black 50%, black 55%, rgba(0,0,0,1) 100%);
    mask-image: radial-gradient(circle, black 50%, black 55%, rgba(0,0,0,1) 100%);
  }
}
.stamp .stamp-img { width: 100%; height: 100%; object-fit: cover; opacity: 0; }
.stamp.active .stamp-img { opacity: 1; transition: opacity 0.5s 0.3s; }
.stamp.active .stamp-number { display: none; }
.stamp.active[data-stamp-id="1"] .stamp-img, .stamp.active[data-stamp-id="2"] .stamp-img, 
.stamp.active[data-stamp-id="4"] .stamp-img, .stamp.active[data-stamp-id="5"] .stamp-img {
  content: url('assets/logo.png');
}
.stamp.active[data-stamp-id="3"] .stamp-img, .stamp.active[data-stamp-id="6"] .stamp-img {
  content: url('assets/truck.png');
}

.reward-item.available { background-color: #E6F5F1; }

/* 9. Modals (Animation & Visual Refresh) */
.modal {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000;
  display: flex; align-items: center; justify-content: center;
  background: rgba(30,30,30,0.3);
  /* 背景ブラー */
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
}
.modal.active { opacity: 1; pointer-events: auto; }
.modal-content {
  background: var(--color-surface); border-radius: var(--radius-lg);
  width: 90%; max-width: 400px; box-shadow: var(--shadow-lg);
  /*
   */
  opacity: 0;
}
.modal.active .modal-content {
  /* GSAPで制御するためCSSアニメーションは削除 */
  opacity: 1;
}

.modal-header { padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); }
.modal-header h3 { font-family: var(--font-display); font-size: 18px; }
.close-modal { background: none; border: none; font-size: 24px; cursor: pointer; color: #6c757d; }
.modal-body { padding: 20px; }

/* 10. Summary Modal (Magazine-style) */
.summary-modal-content { padding: 0; overflow: hidden; }
.summary-close-btn {
  position: absolute; top: 12px; right: 12px;
  background-color: rgba(0,0,0,0.5); color: white; border-radius: 50%;
  width: 32px; height: 32px; display: flex; align-items: center;
  justify-content: center; font-size: 28px; line-height: 1; z-index: 10;
  border: none;
}
.summary-image {
  width: 100%; height: 220px; background-size: cover;
  background-position: center; background-color: var(--color-border);
}
.summary-text-content { padding: 24px; }
#summary-title {
  font-family: var(--font-display); font-size: 28px; font-weight: 800;
  margin-bottom: 8px; line-height: 1.3;
}
.summary-meta {
  font-family: var(--font-accent); /* アクセントフォント適用 */
  font-size: 16px;
  color: var(--color-primary);
  margin-bottom: 20px;
}
#summary-bullets { list-style-type: none; padding: 0; margin: 0 0 24px 0; }
#summary-bullets li {
  font-size: 15px; line-height: 1.7; padding-left: 20px;
  position: relative;
}
#summary-bullets li:not(:last-child) { margin-bottom: 12px; }
#summary-bullets li::before {
  content: '✓'; position: absolute; left: 0; color: var(--color-secondary);
  font-weight: bold;
}

/* 11. Masonry/Feed Adjustments */
.articles-container {
  margin-left: -10px;
}
.grid-sizer, .articles-container .card {
  width: calc(50% - 10px);
  margin-left: 10px;
  margin-bottom: 10px;
}
